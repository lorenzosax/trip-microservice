<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>Dynamic table update</title>
</head>
<body>
    <p>
      Samples
    </p>
	<button type="button" id="connect">Connect</button>
	<button type="button" id="sendMsg" disabled>Send TripReq</button>
    <div id="table-container">
        <table id = "table" border= "1">
            <tr>
                <th> TripId </th>
                <th> VehicleId </th>
                <th> PickUpNodeId </th>
           </tr>
        </table>
    </div>
    <div id="console">
    </div>
	
	
	<script type="application/javascript">

        var Table = {};
	
		Table.write = function(data) {
			   var table = document.getElementById('table');
			   var row = document.createElement('tr');
			   row.appendChild(document.createElement('td'));
			   row.appendChild(document.createElement('td'));
			   row.appendChild(document.createElement('td'));
			   row.cells[0].innerHTML = data.tripId;
			   row.cells[1].innerHTML = data.vehicleId;
			   row.cells[2].innerHTML = data.pickUpNodeId;
			   table.appendChild(row);
		};
        
        var Console = {};

        Console.write = function(message) {
            var console = document.getElementById('console');
            var p = document.createElement('p');
            p.innerHTML = message;
            console.appendChild(p);
        };

        var Channel = {};
        
        Channel.socket = null;


        Channel.connect = function(host) {
			Channel.socket = new WebSocket(host);
            Channel.socket.onopen = function () {
                document.getElementById("sendMsg").disabled = false;
                Console.write("Connection open");
            };

            Channel.socket.onclose = function () {
              Console.write("Connection close");
            };

            Channel.socket.onmessage = function (message) {
                let data = JSON.parse(message.data);
                if (data.tripId)
                    Table.write(data);
                else
                    Console.write(data.status);
            };
        };
		
		document.getElementById("connect").onclick = function() {
			Channel.connect('ws://127.0.0.1:8080/api/city/notifications?token=eyJhbGciOiJIUzUxMiJ9.eyJzdWIiOiJ1c2VycGFzc2VuZ2VyIiwiYXV0aCI6IlJPTEVfUEFTU0VOR0VSIiwiZXhwIjoxNjI1MzA0NDA0fQ.slaxoB_-5_MjiAwhWCKLKYFUD6KuhUo2_UxdIyU9VqRrTnaQwLor-llOkIxJS5X0Gi5UelrLOzisOHqodiQjUQ');
			document.getElementById("connect").disabled = true;
		};

        document.getElementById("sendMsg").onclick = function() {
            var objToSend = {
                osmidSource: 500,
                osmidDestination: 30
            };
			Channel.socket.send(JSON.stringify(objToSend));
			document.getElementById("connect").disabled = true;
		};


    </script>
</body>
</html>
